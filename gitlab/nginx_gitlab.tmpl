upstream gitlab {
    server 127.0.0.1:${HTTP_Port};
}

server {
    listen         0.0.0.0:443 ssl;
    listen         [::]:443             ipv6only=on ssl default_server;
    server_name    ${DOMAIN};
    charset        utf-8;
    server_tokens  off;

    ssl_certificate      /${HOME}/Work/nginx/cert/${DOMAIN}.cer;
    ssl_certificate_key  /${HOME}/Work/nginx/cert/${DOMAIN}.key;
    ssl_ciphers          ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
    ssl_protocols        TLSv1.2 TLSv1.3;

    ssl_prefer_server_ciphers  on;
    ssl_session_cache          shared:SSL:1m;
    ssl_session_timeout        5m;

    access_log  /${HOME}/Work/nginx/log/gitlab.log;
    error_log   /${HOME}/Work/nginx/log/error_gitlab.log;
    gzip        on;
    client_max_body_size     12m;
    client_body_buffer_size  16k;

    location / {
        proxy_pass             http://gitlab;
        proxy_set_header       Host               $host;
        proxy_set_header       X-Real-IP          $remote_addr;
        real_ip_header         X-Real-IP;
        proxy_read_timeout     300;
        proxy_connect_timeout  300;
        proxy_redirect         off;
        proxy_http_version     1.1;
        proxy_set_header       X-Forwarded-Ssl    on;
        proxy_set_header       X-Forwarded-For    $proxy_add_x_forwarded_for;
        proxy_set_header       X-Forwarded-Proto  $scheme;
    }

    if ($host != "${DOMAIN}") {
        return 404;
    }
}
